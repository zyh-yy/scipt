{"remainingRequest":"C:\\Users\\zhuyu\\Desktop\\study\\lijialu\\scipt\\frontend\\node_modules\\@vue\\cli-plugin-babel\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\zhuyu\\Desktop\\study\\lijialu\\scipt\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\zhuyu\\Desktop\\study\\lijialu\\scipt\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\zhuyu\\Desktop\\study\\lijialu\\scipt\\frontend\\src\\views\\ScriptForm.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\zhuyu\\Desktop\\study\\lijialu\\scipt\\frontend\\src\\views\\ScriptForm.vue","mtime":1747316940673},{"path":"C:\\Users\\zhuyu\\Desktop\\study\\lijialu\\scipt\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1747314279003},{"path":"C:\\Users\\zhuyu\\Desktop\\study\\lijialu\\scipt\\frontend\\node_modules\\@vue\\cli-plugin-babel\\node_modules\\babel-loader\\lib\\index.js","mtime":1747314323395},{"path":"C:\\Users\\zhuyu\\Desktop\\study\\lijialu\\scipt\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1747314279003},{"path":"C:\\Users\\zhuyu\\Desktop\\study\\lijialu\\scipt\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1747314281934}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdTY3JpcHRGb3JtJywKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaXNFZGl0OiBmYWxzZSwKICAgICAgc2NyaXB0SWQ6IG51bGwsCiAgICAgIGZvcm06IHsKICAgICAgICBuYW1lOiAnJywKICAgICAgICBkZXNjcmlwdGlvbjogJycsCiAgICAgICAgcGFyYW1ldGVyczogW10KICAgICAgfSwKICAgICAgcnVsZXM6IHsKICAgICAgICBuYW1lOiBbewogICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICBtZXNzYWdlOiAn6K+36L6T5YWl6ISa5pys5ZCN56ewJywKICAgICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICAgIH0sIHsKICAgICAgICAgIG1pbjogMiwKICAgICAgICAgIG1heDogNTAsCiAgICAgICAgICBtZXNzYWdlOiAn6ZW/5bqm5ZyoIDIg5YiwIDUwIOS4quWtl+espicsCiAgICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgICB9XSwKICAgICAgICBmaWxlOiBbewogICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICBtZXNzYWdlOiAn6K+35LiK5Lyg6ISa5pys5paH5Lu2JywKICAgICAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnCiAgICAgICAgfV0KICAgICAgfSwKICAgICAgZmlsZUxpc3Q6IFtdLAogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgc3VibWl0dGluZzogZmFsc2UsCiAgICAgIHVwbG9hZEZpbGU6IG51bGwsCiAgICAgIHVwbG9hZGVkRmlsZUluZm86IG51bGwsCiAgICAgIHVwbG9hZGluZzogZmFsc2UKICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgLy8g5Yik5pat5piv5ZCm5Li657yW6L6R5qih5byPCiAgICB0aGlzLnNjcmlwdElkID0gdGhpcy4kcm91dGUucGFyYW1zLmlkOwogICAgdGhpcy5pc0VkaXQgPSB0aGlzLiRyb3V0ZS5uYW1lID09PSAnU2NyaXB0RWRpdCc7CiAgICBpZiAodGhpcy5pc0VkaXQpIHsKICAgICAgdGhpcy5mZXRjaFNjcmlwdERldGFpbCgpOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgZmV0Y2hTY3JpcHREZXRhaWwoKSB7CiAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7CiAgICAgIHRoaXMuJGF4aW9zLmdldChgL2FwaS9zY3JpcHRzLyR7dGhpcy5zY3JpcHRJZH1gKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5jb2RlID09PSAwKSB7CiAgICAgICAgICBjb25zdCBzY3JpcHQgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICB0aGlzLmZvcm0ubmFtZSA9IHNjcmlwdC5uYW1lOwogICAgICAgICAgdGhpcy5mb3JtLmRlc2NyaXB0aW9uID0gc2NyaXB0LmRlc2NyaXB0aW9uOwogICAgICAgICAgdGhpcy5mb3JtLnBhcmFtZXRlcnMgPSBzY3JpcHQucGFyYW1ldGVycyB8fCBbXTsKCiAgICAgICAgICAvLyDkv67lpI3lj4LmlbBpc19yZXF1aXJlZOWtl+auteexu+WeiwogICAgICAgICAgdGhpcy5mb3JtLnBhcmFtZXRlcnMuZm9yRWFjaChwYXJhbSA9PiB7CiAgICAgICAgICAgIHBhcmFtLmlzX3JlcXVpcmVkID0gcGFyc2VJbnQocGFyYW0uaXNfcmVxdWlyZWQgfHwgMCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXNwb25zZS5kYXRhLm1lc3NhZ2UgfHwgJ+iOt+WPluiEmuacrOivpuaDheWksei0pScpOwogICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9zY3JpcHRzJyk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign6I635Y+W6ISa5pys6K+m5oOF5aSx6LSlOiAnICsgZXJyb3IubWVzc2FnZSk7CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9zY3JpcHRzJyk7CiAgICAgIH0pLmZpbmFsbHkoKCkgPT4gewogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBhZGRQYXJhbSgpIHsKICAgICAgdGhpcy5mb3JtLnBhcmFtZXRlcnMucHVzaCh7CiAgICAgICAgbmFtZTogJycsCiAgICAgICAgZGVzY3JpcHRpb246ICcnLAogICAgICAgIHBhcmFtX3R5cGU6ICdzdHJpbmcnLAogICAgICAgIGlzX3JlcXVpcmVkOiAwLAogICAgICAgIGRlZmF1bHRfdmFsdWU6ICcnCiAgICAgIH0pOwogICAgfSwKICAgIHJlbW92ZVBhcmFtKGluZGV4KSB7CiAgICAgIHRoaXMuZm9ybS5wYXJhbWV0ZXJzLnNwbGljZShpbmRleCwgMSk7CiAgICB9LAogICAgYmVmb3JlVXBsb2FkKGZpbGUpIHsKICAgICAgY29uc3QgaXNWYWxpZFR5cGUgPSBmaWxlLm5hbWUubWF0Y2goL1wuKHB5fHNofGJhdHxwczF8anMpJC9pKTsKICAgICAgaWYgKCFpc1ZhbGlkVHlwZSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ivt+S4iuS8oOaUr+aMgeeahOiEmuacrOaWh+S7tuexu+WeiyEnKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgY29uc3QgaXNMdDVNID0gZmlsZS5zaXplIC8gMTAyNCAvIDEwMjQgPCA1OwogICAgICBpZiAoIWlzTHQ1TSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+aWh+S7tuWkp+Wwj+S4jeiDvei2hei/hyA1TUIhJyk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHRoaXMudXBsb2FkRmlsZSA9IGZpbGU7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIGhhbmRsZUV4Y2VlZCgpIHsKICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCflj6rog73kuIrkvKDkuIDkuKrmlofku7YnKTsKICAgIH0sCiAgICBoYW5kbGVVcGxvYWQob3B0aW9ucykgewogICAgICAvLyDpgInmi6nmlofku7blkI7vvIznq4vljbPkuIrkvKDmlofku7YKICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgZm9ybURhdGEuYXBwZW5kKCdmaWxlJywgb3B0aW9ucy5maWxlKTsKICAgICAgdGhpcy51cGxvYWRpbmcgPSB0cnVlOwogICAgICB0aGlzLiRheGlvcy5wb3N0KCcvYXBpL3NjcmlwdHMvdXBsb2FkLWZpbGUnLCBmb3JtRGF0YSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuY29kZSA9PT0gMCkgewogICAgICAgICAgdGhpcy51cGxvYWRlZEZpbGVJbmZvID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCfmlofku7bkuIrkvKDmiJDlip8nKTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHN0YXR1czogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXNwb25zZS5kYXRhLm1lc3NhZ2UgfHwgJ+S4iuS8oOaWh+S7tuWksei0pScpOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc3RhdHVzOiBmYWxzZQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfkuIrkvKDmlofku7blpLHotKU6ICcgKyBlcnJvci5tZXNzYWdlKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgc3RhdHVzOiBmYWxzZQogICAgICAgIH07CiAgICAgIH0pLmZpbmFsbHkoKCkgPT4gewogICAgICAgIHRoaXMudXBsb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwoKICAgICAgLy8g6L+U5Zue5LiK5Lyg54q25oCBCiAgICAgIHJldHVybiB7CiAgICAgICAgc3RhdHVzOiB0cnVlCiAgICAgIH07CiAgICB9LAogICAgc3VibWl0Rm9ybSgpIHsKICAgICAgdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKHZhbGlkID0+IHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIHRoaXMuc3VibWl0dGluZyA9IHRydWU7CgogICAgICAgICAgLy8g5qOA5p+l5Y+C5pWw6KGo5Y2V5piv5ZCm5aGr5YaZ5a6M5pW0CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZm9ybS5wYXJhbWV0ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IHBhcmFtID0gdGhpcy5mb3JtLnBhcmFtZXRlcnNbaV07CiAgICAgICAgICAgIGlmICghcGFyYW0ubmFtZSkgewogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+WPguaVsOWQjeensOS4jeiDveS4uuepuicpOwogICAgICAgICAgICAgIHRoaXMuc3VibWl0dGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuaXNFZGl0KSB7CiAgICAgICAgICAgIHRoaXMudXBkYXRlU2NyaXB0KCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmFkZFNjcmlwdCgpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBhZGRTY3JpcHQoKSB7CiAgICAgIC8vIOajgOafpeaYr+WQpuacieS4iuS8oOeahOaWh+S7tuS/oeaBrwogICAgICBpZiAoIXRoaXMudXBsb2FkZWRGaWxlSW5mbykgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ivt+WFiOmAieaLqeW5tuS4iuS8oOiEmuacrOaWh+S7ticpOwogICAgICAgIHRoaXMuc3VibWl0dGluZyA9IGZhbHNlOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8g5L2/55So5bey5LiK5Lyg5paH5Lu255qE5L+h5oGvCiAgICAgIGNvbnN0IGRhdGEgPSB7CiAgICAgICAgbmFtZTogdGhpcy5mb3JtLm5hbWUsCiAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuZm9ybS5kZXNjcmlwdGlvbiwKICAgICAgICBmaWxlX3BhdGg6IHRoaXMudXBsb2FkZWRGaWxlSW5mby5maWxlX3BhdGgsCiAgICAgICAgZmlsZV90eXBlOiB0aGlzLnVwbG9hZGVkRmlsZUluZm8uZmlsZV90eXBlLAogICAgICAgIHBhcmFtZXRlcnM6IHRoaXMuZm9ybS5wYXJhbWV0ZXJzCiAgICAgIH07CgogICAgICAvLyDlj5HpgIHor7fmsYIgLSDkvKDpgJLohJrmnKzkv6Hmga/lkozmlofku7ZJRAogICAgICB0aGlzLiRheGlvcy5wb3N0KCcvYXBpL3NjcmlwdHMnLCBkYXRhKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5jb2RlID09PSAwKSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+a3u+WKoOiEmuacrOaIkOWKnycpOwogICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9zY3JpcHRzJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzcG9uc2UuZGF0YS5tZXNzYWdlIHx8ICfmt7vliqDohJrmnKzlpLHotKUnKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfmt7vliqDohJrmnKzlpLHotKU6ICcgKyBlcnJvci5tZXNzYWdlKTsKICAgICAgfSkuZmluYWxseSgoKSA9PiB7CiAgICAgICAgdGhpcy5zdWJtaXR0aW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIHVwZGF0ZVNjcmlwdCgpIHsKICAgICAgLy8g5pu05paw6ISa5pys5L+h5oGvCiAgICAgIHRoaXMuJGF4aW9zLnB1dChgL2FwaS9zY3JpcHRzLyR7dGhpcy5zY3JpcHRJZH1gLCB7CiAgICAgICAgbmFtZTogdGhpcy5mb3JtLm5hbWUsCiAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuZm9ybS5kZXNjcmlwdGlvbiwKICAgICAgICBwYXJhbWV0ZXJzOiB0aGlzLmZvcm0ucGFyYW1ldGVycwogICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5jb2RlID09PSAwKSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+abtOaWsOiEmuacrOaIkOWKnycpOwogICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9zY3JpcHRzJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzcG9uc2UuZGF0YS5tZXNzYWdlIHx8ICfmm7TmlrDohJrmnKzlpLHotKUnKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfmm7TmlrDohJrmnKzlpLHotKU6ICcgKyBlcnJvci5tZXNzYWdlKTsKICAgICAgfSkuZmluYWxseSgoKSA9PiB7CiAgICAgICAgdGhpcy5zdWJtaXR0aW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGNhbmNlbCgpIHsKICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsKICAgIH0KICB9Cn07"},{"version":3,"names":["name","data","isEdit","scriptId","form","description","parameters","rules","required","message","trigger","min","max","file","fileList","loading","submitting","uploadFile","uploadedFileInfo","uploading","created","$route","params","id","fetchScriptDetail","methods","$axios","get","then","response","code","script","forEach","param","is_required","parseInt","$message","error","$router","push","catch","finally","addParam","param_type","default_value","removeParam","index","splice","beforeUpload","isValidType","match","isLt5M","size","handleExceed","warning","handleUpload","options","formData","FormData","append","post","success","status","submitForm","$refs","validate","valid","i","length","updateScript","addScript","file_path","file_type","put","cancel","go"],"sources":["src/views/ScriptForm.vue"],"sourcesContent":["<template>\r\n  <div class=\"script-form\">\r\n    <div class=\"page-container\">\r\n      <h1 class=\"page-title\">{{ isEdit ? '编辑脚本' : '添加脚本' }}</h1>\r\n      \r\n      <el-form \r\n        ref=\"form\" \r\n        :model=\"form\" \r\n        :rules=\"rules\" \r\n        label-width=\"100px\" \r\n        class=\"form-container\"\r\n        v-loading=\"loading\"\r\n      >\r\n        <el-form-item label=\"脚本名称\" prop=\"name\">\r\n          <el-input v-model=\"form.name\" placeholder=\"请输入脚本名称\"></el-input>\r\n        </el-form-item>\r\n        \r\n        <el-form-item label=\"脚本描述\" prop=\"description\">\r\n          <el-input \r\n            type=\"textarea\" \r\n            v-model=\"form.description\" \r\n            placeholder=\"请输入脚本描述\"\r\n            :rows=\"4\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        \r\n        <el-form-item label=\"脚本文件\" prop=\"file\" v-if=\"!isEdit\">\r\n          <el-upload\r\n            class=\"upload-demo\"\r\n            ref=\"upload\"\r\n            action=\"#\"\r\n            :http-request=\"handleUpload\"\r\n            :before-upload=\"beforeUpload\"\r\n            :limit=\"1\"\r\n            :on-exceed=\"handleExceed\"\r\n            :file-list=\"fileList\"\r\n          >\r\n            <el-button size=\"small\" type=\"primary\">选择文件</el-button>\r\n            <div slot=\"tip\" class=\"el-upload__tip\">\r\n              支持上传 Python(.py), Shell(.sh), Batch(.bat), PowerShell(.ps1), JavaScript(.js) 文件\r\n            </div>\r\n          </el-upload>\r\n        </el-form-item>\r\n        \r\n        <el-form-item label=\"参数配置\">\r\n          <div class=\"parameters-header\">\r\n            <h3>脚本参数列表</h3>\r\n            <el-button type=\"primary\" size=\"small\" @click=\"addParam\">\r\n              <i class=\"el-icon-plus\"></i> 添加参数\r\n            </el-button>\r\n          </div>\r\n          \r\n          <el-table :data=\"form.parameters\" border style=\"width: 100%\">\r\n            <el-table-column label=\"参数名称\" prop=\"name\" width=\"150\">\r\n              <template slot-scope=\"scope\">\r\n                <el-input v-model=\"scope.row.name\" placeholder=\"参数名称\"></el-input>\r\n              </template>\r\n            </el-table-column>\r\n            \r\n            <el-table-column label=\"参数描述\" prop=\"description\">\r\n              <template slot-scope=\"scope\">\r\n                <el-input v-model=\"scope.row.description\" placeholder=\"参数描述\"></el-input>\r\n              </template>\r\n            </el-table-column>\r\n            \r\n            <el-table-column label=\"参数类型\" prop=\"param_type\" width=\"150\">\r\n              <template slot-scope=\"scope\">\r\n                <el-select v-model=\"scope.row.param_type\" placeholder=\"参数类型\">\r\n                  <el-option label=\"字符串\" value=\"string\"></el-option>\r\n                  <el-option label=\"数字\" value=\"number\"></el-option>\r\n                  <el-option label=\"布尔值\" value=\"boolean\"></el-option>\r\n                  <el-option label=\"选择框\" value=\"select\"></el-option>\r\n                </el-select>\r\n              </template>\r\n            </el-table-column>\r\n            \r\n            <el-table-column label=\"是否必填\" prop=\"is_required\" width=\"100\">\r\n              <template slot-scope=\"scope\">\r\n                <el-switch v-model=\"scope.row.is_required\" :active-value=\"1\" :inactive-value=\"0\"></el-switch>\r\n              </template>\r\n            </el-table-column>\r\n            \r\n            <el-table-column label=\"默认值\" prop=\"default_value\" width=\"150\">\r\n              <template slot-scope=\"scope\">\r\n                <el-input v-model=\"scope.row.default_value\" placeholder=\"默认值\"></el-input>\r\n              </template>\r\n            </el-table-column>\r\n            \r\n            <el-table-column label=\"操作\" width=\"100\">\r\n              <template slot-scope=\"scope\">\r\n                <el-button\r\n                  type=\"danger\"\r\n                  size=\"mini\"\r\n                  @click=\"removeParam(scope.$index)\"\r\n                >\r\n                  删除\r\n                </el-button>\r\n              </template>\r\n            </el-table-column>\r\n          </el-table>\r\n        </el-form-item>\r\n        \r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"submitForm\" :loading=\"submitting\">保存</el-button>\r\n          <el-button @click=\"cancel\">取消</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'ScriptForm',\r\n  data() {\r\n    return {\r\n      isEdit: false,\r\n      scriptId: null,\r\n      form: {\r\n        name: '',\r\n        description: '',\r\n        parameters: []\r\n      },\r\n      rules: {\r\n        name: [\r\n          { required: true, message: '请输入脚本名称', trigger: 'blur' },\r\n          { min: 2, max: 50, message: '长度在 2 到 50 个字符', trigger: 'blur' }\r\n        ],\r\n        file: [\r\n          { required: true, message: '请上传脚本文件', trigger: 'change' }\r\n        ]\r\n      },\r\n      fileList: [],\r\n      loading: false,\r\n      submitting: false,\r\n      uploadFile: null,\r\n      uploadedFileInfo: null,\r\n      uploading: false\r\n    };\r\n  },\r\n  created() {\r\n    // 判断是否为编辑模式\r\n    this.scriptId = this.$route.params.id;\r\n    this.isEdit = this.$route.name === 'ScriptEdit';\r\n    \r\n    if (this.isEdit) {\r\n      this.fetchScriptDetail();\r\n    }\r\n  },\r\n  methods: {\r\n    fetchScriptDetail() {\r\n      this.loading = true;\r\n      this.$axios.get(`/api/scripts/${this.scriptId}`)\r\n        .then(response => {\r\n          if (response.data.code === 0) {\r\n            const script = response.data.data;\r\n            this.form.name = script.name;\r\n            this.form.description = script.description;\r\n            this.form.parameters = script.parameters || [];\r\n            \r\n            // 修复参数is_required字段类型\r\n            this.form.parameters.forEach(param => {\r\n              param.is_required = parseInt(param.is_required || 0);\r\n            });\r\n          } else {\r\n            this.$message.error(response.data.message || '获取脚本详情失败');\r\n            this.$router.push('/scripts');\r\n          }\r\n        })\r\n        .catch(error => {\r\n          this.$message.error('获取脚本详情失败: ' + error.message);\r\n          this.$router.push('/scripts');\r\n        })\r\n        .finally(() => {\r\n          this.loading = false;\r\n        });\r\n    },\r\n    addParam() {\r\n      this.form.parameters.push({\r\n        name: '',\r\n        description: '',\r\n        param_type: 'string',\r\n        is_required: 0,\r\n        default_value: ''\r\n      });\r\n    },\r\n    removeParam(index) {\r\n      this.form.parameters.splice(index, 1);\r\n    },\r\n    beforeUpload(file) {\r\n      const isValidType = file.name.match(/\\.(py|sh|bat|ps1|js)$/i);\r\n      if (!isValidType) {\r\n        this.$message.error('请上传支持的脚本文件类型!');\r\n        return false;\r\n      }\r\n      \r\n      const isLt5M = file.size / 1024 / 1024 < 5;\r\n      if (!isLt5M) {\r\n        this.$message.error('文件大小不能超过 5MB!');\r\n        return false;\r\n      }\r\n      \r\n      this.uploadFile = file;\r\n      return true;\r\n    },\r\n    handleExceed() {\r\n      this.$message.warning('只能上传一个文件');\r\n    },\r\n    handleUpload(options) {\r\n      // 选择文件后，立即上传文件\r\n      const formData = new FormData();\r\n      formData.append('file', options.file);\r\n      \r\n      this.uploading = true;\r\n      \r\n      this.$axios.post('/api/scripts/upload-file', formData)\r\n        .then(response => {\r\n          if (response.data.code === 0) {\r\n            this.uploadedFileInfo = response.data.data;\r\n            this.$message.success('文件上传成功');\r\n            return { status: true };\r\n          } else {\r\n            this.$message.error(response.data.message || '上传文件失败');\r\n            return { status: false };\r\n          }\r\n        })\r\n        .catch(error => {\r\n          this.$message.error('上传文件失败: ' + error.message);\r\n          return { status: false };\r\n        })\r\n        .finally(() => {\r\n          this.uploading = false;\r\n        });\r\n      \r\n      // 返回上传状态\r\n      return { status: true };\r\n    },\r\n    submitForm() {\r\n      this.$refs.form.validate(valid => {\r\n        if (valid) {\r\n          this.submitting = true;\r\n          \r\n          // 检查参数表单是否填写完整\r\n          for (let i = 0; i < this.form.parameters.length; i++) {\r\n            const param = this.form.parameters[i];\r\n            if (!param.name) {\r\n              this.$message.error('参数名称不能为空');\r\n              this.submitting = false;\r\n              return;\r\n            }\r\n          }\r\n          \r\n          if (this.isEdit) {\r\n            this.updateScript();\r\n          } else {\r\n            this.addScript();\r\n          }\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n    addScript() {\r\n      // 检查是否有上传的文件信息\r\n      if (!this.uploadedFileInfo) {\r\n        this.$message.error('请先选择并上传脚本文件');\r\n        this.submitting = false;\r\n        return;\r\n      }\r\n      \r\n      // 使用已上传文件的信息\r\n      const data = {\r\n        name: this.form.name,\r\n        description: this.form.description,\r\n        file_path: this.uploadedFileInfo.file_path,\r\n        file_type: this.uploadedFileInfo.file_type,\r\n        parameters: this.form.parameters\r\n      };\r\n      \r\n      // 发送请求 - 传递脚本信息和文件ID\r\n      this.$axios.post('/api/scripts', data)\r\n        .then(response => {\r\n          if (response.data.code === 0) {\r\n            this.$message.success('添加脚本成功');\r\n            this.$router.push('/scripts');\r\n          } else {\r\n            this.$message.error(response.data.message || '添加脚本失败');\r\n          }\r\n        })\r\n        .catch(error => {\r\n          this.$message.error('添加脚本失败: ' + error.message);\r\n        })\r\n        .finally(() => {\r\n          this.submitting = false;\r\n        });\r\n    },\r\n    updateScript() {\r\n      // 更新脚本信息\r\n      this.$axios.put(`/api/scripts/${this.scriptId}`, {\r\n        name: this.form.name,\r\n        description: this.form.description,\r\n        parameters: this.form.parameters\r\n      })\r\n        .then(response => {\r\n          if (response.data.code === 0) {\r\n            this.$message.success('更新脚本成功');\r\n            this.$router.push('/scripts');\r\n          } else {\r\n            this.$message.error(response.data.message || '更新脚本失败');\r\n          }\r\n        })\r\n        .catch(error => {\r\n          this.$message.error('更新脚本失败: ' + error.message);\r\n        })\r\n        .finally(() => {\r\n          this.submitting = false;\r\n        });\r\n    },\r\n    cancel() {\r\n      this.$router.go(-1);\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.parameters-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 10px;\r\n  \r\n  h3 {\r\n    margin: 0;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]}]}